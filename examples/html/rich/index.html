<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rich Message Example | intor-translator</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <h1></h1>

    <div>
      <button data-locale="en-US">en-US</button>
      <button data-locale="zh-TW">zh-TW</button>
    </div>

    <!-- AST output -->
    <div>
      <code>Parsed AST</code>
      <pre id="ast"></pre>
    </div>

    <script type="module">
      import {
        Translator,
        parseRichMessage,
        renderRichMessage,
      } from "https://cdn.jsdelivr.net/npm/intor-translator/+esm";

      /**
       * Initialize translator with rich-formatted messages.
       */
      const translator = new Translator({
        locale: "en-US",
        messages: {
          "en-US": {
            welcome: 'Welcome to <link href="/home"><i>our site</i></link>!',
          },
          "zh-TW": {
            welcome: '歡迎來到<link href="/home"><i>我們的網站</i></link>！',
          },
        },
      });

      const h1Element = document.querySelector("h1");
      const astElement = document.querySelector("#ast");

      /**
       * DOM renderer for semantic rich messages.
       *
       * This renderer defines how semantic tags are
       * mapped to actual DOM elements.
       */
      const domRenderer = {
        text(value) {
          return document.createTextNode(value);
        },

        tag(name, attributes, children) {
          const TAG_MAP = {
            link: "a",
            i: "i",
          };

          const el = document.createElement(TAG_MAP[name] ?? name);

          for (const [key, value] of Object.entries(attributes)) {
            el.setAttribute(key, value);
          }

          children.forEach((child) => el.appendChild(child));
          return el;
        },
      };

      /**
       * Render flow:
       *
       * translate → parse rich message → render via renderer
       */
      const render = () => {
        h1Element.innerHTML = "";

        const message = translator.t("welcome");

        // Render rich message into DOM nodes
        const nodes = renderRichMessage(message, domRenderer);
        nodes.forEach((node) => h1Element.appendChild(node));

        // Inspect semantic AST
        const ast = parseRichMessage(message);
        astElement.textContent = JSON.stringify(ast, null, 2);
      };

      render();

      /**
       * Switch locale dynamically.
       */
      document.querySelectorAll("button[data-locale]").forEach((button) => {
        button.addEventListener("click", () => {
          translator.setLocale(button.dataset.locale);
          render();
        });
      });
    </script>
  </body>
</html>
